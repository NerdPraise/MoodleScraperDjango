{%extends "base.html"%}
{%load static%}
{%block title%} <title>Moodle Attendance | Student</title>{%endblock title%}
{%block content%}

<body>
    <!-- SIDE NAV -->
    <div class="sidenav" id="sidenav">
        <div class="sidehead" id="sidehead1" style="color:white; text-align:center; padding:10px 15px;font-size:18px">
            <span>Welcome, <strong>{{user.username}} 👨😊✌🙌🥰</strong></span><br>
            <p>Points: {%if user.userprofile.paid %} Unlimited {%else %} {{user.userprofile.points}}{%endif%}</p>
        </div>
        <hr>
        <div class="sidehead" id="sidehead2">
            <ul>
                <li><a href="#" style="padding:10px 15px"><i class="pe-7s-graph"></i> DASHBOARD</a></li>
                <li><a href="#" style="padding:10px 15px"><i class="pe-7s-note2"></i>TASKS</a></li>
                <li><a href="#" style="padding:10px 15px"><i class="pe-7s-news-paper"></i>POSTS</a></li>
                <li><a href="#" style="padding:10px 15px"><i class="pe-7s-user"></i>USER PROFILE</a></li>
            </ul>
        </div>

    </div>

    <div class="main" id="main">
        <!-- NAV BAR -->
        <div class="navbar">
            <div class="row navelem">
                <div class="navtext quarter">Dashboard</div>
                <div class="togglebtn rest"><a onclick="toggleNav()">☰</a></div>
                <div class="othnav rest">
                    <ul style="margin:0; float: right;">
                        <li>{{user.email}}</li>
                        <li>Actions </li>
                        <li><button class="btn blue" onclick="location.href='{%url 'logout'%}'" type="submit">LOG
                                OUT</button> </li>
                    </ul>

                </div>
            </div>
        </div>

        <div class="mainblrbs">
            <!-- BODY BLURBS FOUR -->
            <div class="details row">
                <div class="row">
                    <div class="quarter">
                        <div class="blurbs pd15">
                            <div class="row" style="padding-bottom: 25px;">
                                <div class="md12">
                                    <div class="icon quarter"><i class="pe-7s-hammer"
                                            style="color:orange; font-size: 40px; font-weight: 700;"></i></div>
                                    <div class="blb-text rest">
                                        <p style="font-size: 16px;">Last login</p>
                                        <p class="blurb-num">{{last_login}}</p>
                                    </div>
                                </div>
                                <hr>
                            </div>
                        </div>
                    </div>
                    <div class="quarter">
                        <div class="blurbs pd15">
                            <div class="row" style="padding-bottom: 25px;">
                                <div class="md12">
                                    <div class="icon quarter"><i class="pe-7s-server"
                                            style="color:#87cb16!important; font-size: 40px; font-weight: 700;"></i>
                                    </div>
                                    <div class="blb-text rest">
                                        <p style="font-size: 16px;">Current Stage</p>
                                        <p class="blurb-num">4</p>
                                    </div>
                                </div>
                                <hr>
                            </div>
                        </div>
                    </div>
                    <div class="quarter">
                        <div class="blurbs pd15">
                            <div class="row" style="padding-bottom: 25px;">
                                <div class="md12">
                                    <div class="icon quarter"><i class="pe-7s-graph1"
                                            style="color:red; font-size: 40px; font-weight: 700;"></i></div>
                                    <div class="blb-text rest">
                                        <p style="font-size: 16px;">Current Stage</p>
                                        <p class="blurb-num">4</p>
                                    </div>
                                </div>
                                <hr>
                            </div>
                        </div>
                    </div>
                    <div class="quarter">
                        <div class="blurbs pd15">
                            <div class="row" style="padding-bottom: 25px;">
                                <div class="md12">
                                    <div class="icon quarter"><i class="pe-7s-user"
                                            style="color:#1dc7ea!important; font-size: 40px; font-weight: 700;"></i>
                                    </div>
                                    <div class="blb-text rest">
                                        <p style="font-size: 16px;">Current Stage</p>
                                        <p class="blurb-num">4</p>
                                    </div>
                                </div>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- BODY BLURBS TWO -->
            {%if course_name%}
            <div>
                {%if error%}
                <p class="w3-text-red">{{error}}</p>
                {%endif%}
                <p class="w3-text-pink">Just went to {{course_name}} 😊</p>
                {%endif%}
            </div>
            <div class="pstsk row">
                <div class="row">
                    <div class="half pd-l20">
                        <div class="blurbs">
                            <div class="header pd15">
                                <h4 style="font-weight: 300;">MY COURSES</h4>
                                <p style="font-size: 14px;">Here, you see all your courses</p>
                            </div>
                            <!-- FOR TASKS -->
                            <div class="tasklist">
                                <ul>
                                    {%for course in course_one%}
                                    <li>
                                        <div class="listitem">
                                            <p id="{{course.id}}" course-url="{%url 'one_course' course.id %}"
                                                style="font-size: 1em;">
                                                <strong>{{course.course_name |truncatechars:35}}</strong>
                                            </p>
                                            <small>Deadline: 24/04/2020 12:00 AM</small>
                                            <div>
                                                <button class="blue badges recBtn" type="button"
                                                    id="{{course.id}}">Record</button>
                                                <button class=" orange badges"
                                                    onclick="location.href='{%url 'download' course.id %}';"
                                                    type="button">Download</button>
                                            </div>
                                        </div>
                                    </li>
                                    {%endfor%}

                                </ul>
                            </div>
                            <hr>
                        </div>
                    </div>
                    <!-- FOR POST -->
                    <div class="half pd-l20">
                        <div class="blurbs ">
                            <div class="header pd15">
                                <h4 style="font-weight: 300;">Latest Posts</h4>
                                <p style="font-size: 14px;">Here, you see the 5 latest tasks</p>
                            </div>
                            <div class="tasklist">
                                <ul>
                                    {%for course in course_two%}
                                    <li>
                                        <div class="listitem">
                                            <p id="{{course.id}}" course-url="{%url 'one_course' course.id %}"
                                                style="font-size: 1em;">
                                                <strong>{{course.course_name |truncatechars:55}}</strong>
                                            </p>
                                            <small class="d">Deadline: 24/04/2020 12:00 AM</small>
                                            <div>
                                                <button class="closed badges recBtn" id="{{course.id}}"
                                                    type="button">Record</button>
                                                <button class="orange badges dwnBtn" id="{{course.id}}"
                                                    type="button">Download</button>
                                            </div>
                                        </div>
                                    </li>
                                    {%endfor%}

                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="closed badges" id="22" type="button">Record</button>
        {%if course_one or course_two %}
        <div class="w3-center  w3-margin-top">
            <form action="{% url 'all_course'%}" method="POST">
                {%csrf_token%}
                <input type="checkbox" id="1" disabled name="check-quiz" class="w3-check"> Check (Quizzes /
                Assignment)<br>
                <button class="w3-button w3-card" type="button">Record
                    all</button>
            </form>
        </div>
        {%endif%}


        <div id="id01" class="w3-modal modal">
            <div class="w3-modal-content w3-round-large w3-card-4 w3-animate-zoom" style="width:400px; height: 400px;">

                <div class="w3-center clear w3-padding-64">
                    <div class="lds-dual-ring"></div>
                    <div class="animate-bottom error-text"></div>

                </div>
                <div class="w3-clear"></div>



                <div class="w3-container w3-padding-16" style="bottom:0; position:absolute;">
                    <button class="close" type="button" class="w3-button w3-light-grey">Cancel</button>
                </div>
            </div>
        </div>

        


        <div class="footer">
            <h4>ENJOY</h4>
            <button class="btn blue" onclick="location.href='{%url 'payment'%}'" type="submit">Buy Basic 😘</button>
            <p>Developed for CU Students</a></p>
        </div>
    </div>




</body>

{%endblock content%}

{%block javascript%}
<script>
    var sidebar = 0
    function toggleNav() {
        if (sidebar == 0) {
            document.getElementById("sidenav").style.width = "260px";
            document.getElementById("main").style.marginRight = "260px";
            document.getElementById("main").style.marginLeft = "-260px";
            document.getElementById("sidehead1").style.display = "block"
            document.getElementById("sidehead2").style.display = "block"
        } else {
            document.getElementById("sidenav").style.width = "0px";
            document.getElementById("main").style.marginLeft = "0";
            document.getElementById("main").style.marginRight = "0";
            document.getElementById("sidehead1").style.display = "none"
            document.getElementById("sidehead2").style.display = "none"
        }
        sidebar = parseInt(document.getElementById("sidenav").style.width)

    }

    $(".recBtn").click(function () {
        $(".modal").css("display", "block")
        var btn_id = $(this).attr("id")
        btn_id = btn_id.toString()
        let course_url = $("p#" + btn_id).attr("course-url")
        $.ajax({
            url: course_url,
            data: {},
            dataType: 'json',
            success: function (data) {
                if (data.error) {
                    $(".lds-dual-ring").css("display", "none")
                    $(".error-text").text(data.error)
                } else if (data.success) {
                    $(".lds-dual-ring").css("display", "none")
                    $(".error-text").text(data.success + "🙌")
                }
            },
            error: function () {
                $(".lds-dual-ring").css("display", "none")
                $(".error-text").text("Something went wrong, Reload your page")
            }
        })
    })


    $(".close").click(function () {
        $(".error-text").text("")
        $(".lds-dual-ring").css("display", "inline-block")
        $(".modal").css("display", "none")

    })

    $(".dnwBtn").click(function () {
        $(".modal").css("display", "block")
        var button_id = $(this).attr("id")
        button_id = button_id.toString()
        $(".error-text").text("It takes a while if your connection is low, Just chill out 😎🍷🥂")
        $.ajax({
            url: "student/dwnld-" + button_id,
            data: {},
            dataType: 'json',
            success: function (data) {
                if (data.error) {
                    $(".lds-dual-ring").css("display", "none")
                    $(".error-text").text(data.error)
                } else if (data.success) {
                    $(".lds-dual-ring").css("display", "none")
                    $(".error-text").text(data.success + "🙌")
                }
            }
        })
    })



//     $('a.menu').bind('click', function(){
//     alert($(this).attr('id')); // gets the id of a clicked link that has a class of menu
// });

</script>
{%endblock%}